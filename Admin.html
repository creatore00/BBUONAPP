<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rota Management System</title>
<style>
body {
    font-family: 'Arial', sans-serif;
    margin: 0;
    padding: 0;
    background: #f4f6f9;
    color: #333;
    display: flex;
    flex-direction: column;
    min-height: 100vh;
}

header {
    background: #004f9e;
    color: #fff;
    padding: 20px;
    text-align: center;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    position: relative; /* Ensure the dropdown content is positioned relative to the header */
}

header h1 {
    margin: 0;
    font-size: 2em;
}

.dropdown {
    position: absolute; /* Position dropdown absolutely */
    top: 20px;
    right: 20px;
}

.dropbtn {
    background-color: #007acc;
    color: white;
    padding: 10px 20px;
    font-size: 16px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
}

.dropdown-content {
    display: none;
    position: absolute; /* Position dropdown content absolutely */
    top: 100%; /* Position below the button */
    right: 0;
    background-color: #f9f9f9;
    min-width: 160px;
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
    z-index: 1;
    border-radius: 8px; /* Rounded corners for dropdown content */
}

.dropdown-content a {
    color: black;
    padding: 12px 16px;
    text-decoration: none;
    display: block;
    border-radius: 8px; /* Rounded corners for dropdown items */
}

.dropdown-content a:hover {
    background-color: #f1f1f1;
}

.dropdown:hover .dropdown-content {
    display: block;
}

.container {
    width: 90%;
    max-width: 1200px;
    margin: 40px auto;
    padding: 20px;
    background: #fff;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    border-radius: 8px;
}

.button-group {
    display: flex;
    justify-content: space-around;
    margin-bottom: 30px;
}

.button-group a {
    text-decoration: none;
    background: #007acc;
    color: #fff;
    padding: 12px 24px;
    border-radius: 5px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    transition: background 0.3s ease;
    font-weight: bold;
}

.button-group a:hover {
    background: #005fa3;
}

.features {
    display: flex;
    justify-content: space-between;
    gap: 20px;
}

.feature {
    flex: 1;
    padding: 20px;
    background: #f1f3f5;
    border-radius: 8px;
    text-align: center;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

.feature h2 {
    margin-bottom: 15px;
    font-size: 1.5em;
    color: #004f9e;
}

.feature p {
    font-size: 1em;
    color: #666;
}

.rota-form {
    margin-top: 30px;
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.rota-form label {
    font-size: 1em;
    font-weight: bold;
}

.rota-form input[type="date"] {
    padding: 8px;
    font-size: 1em;
    border-radius: 5px;
    border: 1px solid #ccc;
}

.rota-form button {
    padding: 10px 20px;
    background: #007acc;
    color: #fff;
    border: none;
    border-radius: 5px;
    font-size: 1em;
    cursor: pointer;
}

.rota-form button:hover {
    background: #005fa3;
}

footer {
    background: #004f9e;
    color: #fff;
    text-align: center;
    padding: 10px 0;
    margin-top: auto;
    box-shadow: 0 -4px 6px rgba(0, 0, 0, 0.1);
}

footer p {
    margin: 0;
    font-size: 0.9em;
}

@media (max-width: 768px) {
    .features {
        flex-direction: column;
        align-items: center;
    }

    .feature {
        width: 100%;
        margin-bottom: 20px;
    }

    .button-group {
        flex-direction: column;
        align-items: center;
    }

    .button-group a {
        width: 100%;
        text-align: center;
        margin-bottom: 10px;
    }
}

</style>
</head>
<body>
    <header>
        <h1>Rota Management System</h1>
        <div class="dropdown">
            <button class="dropbtn">Account</button>
            <div class="dropdown-content">
                <a href="/profile">My Profile</a>
                <a href="/generate">Create New User</a>
                <a href="/UserTotalHours">Total Hours Worked</a>
                <a href="/hours">Daily Tips Summary</a>
                <a href="/TotalHolidays">Holiday Overview</a>
                <a href="/insertpayslip">Upload New Payslips</a>
                <a href="/pastpayslips">View Past Payslips</a>
                <a href="/modify">Edit Employee Data</a>
                <a href="#" id="logoutBtn">Sign Out</a>                
            </div>
        </div>
    </header>

    <div class="container">
        <div class="button-group">
            <a href="/rota">Create New Rota</a>
            <a href="/confirmrota">Approve Rota</a>
            <a href="/tip">Manage Daily Tips</a>
            <a href="/updateinfo">Employee Directory</a>
            <a href="/userholidays">Holiday Requests</a>
            <a href="/request">Manage Requests</a>            
        </div>

        <div class="features">
            <div class="feature">
                <h2>Efficient Scheduling</h2>
                <p>Organize your teamâ€™s work schedule effortlessly.</p>
            </div>
            <div class="feature">
                <h2>Real-Time Updates</h2>
                <p>Instant notifications for any schedule changes.</p>
            </div>
            <div class="feature">
                <h2>Detailed Reporting</h2>
                <p>Track hours, shifts, and performance with ease.</p>
            </div>
        </div>

        <form class="rota-form" id="rotaForm">
            <label for="date">Date:</label>
            <input type="date" id="date" name="date">
            <button type="submit">Get Info</button>
        </form>

        <div id="who"></div>
    </div>

    <footer>
        <p>&copy; 2024 SoftIt. All Rights Reserved.</p>
    </footer>
<script>
document.getElementById('rotaForm').addEventListener('submit', function(event) {
            event.preventDefault();
            const date = document.getElementById('date').value;
            const formattedDate = formatDate(date);

            fetch('/getRota', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ date: formattedDate })
            })
            .then(response => response.json())
            .then(data => {
                if (data.rota) {
                    const tableHtml = `
                        <table border="1" width="100%" align="center">
                            <tr>
                                <th>Selected Date</th>
                                <th>Confirmed By</th>
                            </tr>
                            <tr>
                                <td>${formattedDate}</td>
                                <td>${data.rota}</td>
                            </tr>
                        </table>
                    `;
                    document.getElementById('who').innerHTML = tableHtml;
                } else {
                    document.getElementById('who').innerHTML = '<div class="date">No data found for the selected date</div>';
                }
            })
            .catch(error => {
                console.error('Error fetching data:', error);
                document.getElementById('who').innerHTML = 'Error fetching data';
            });
        });
function formatDate(date) {
            const dateObj = new Date(date);
            const day = String(dateObj.getDate()).padStart(2, '0');
            const month = String(dateObj.getMonth() + 1).padStart(2, '0');
            const year = dateObj.getFullYear();
            const dayName = dateObj.toLocaleDateString('en-GB', { weekday: 'long' });

            return `${day}/${month}/${year} (${dayName})`;
        }
let inactivityTimer;
const resetInactivityTimer = () => {
    clearTimeout(inactivityTimer);
    inactivityTimer = setTimeout(() => {
        alert('You have been logged out due to inactivity.');
        window.location.href = '/logout'; // Replace with your logout route
    }, 60 * 60 * 1000); // 5 minutes in milliseconds
};
// Track user activity
window.onload = resetInactivityTimer;
window.onmousemove = resetInactivityTimer;
window.onkeypress = resetInactivityTimer;
// Function to get query parameters
function getQueryParams() {
    const params = new URLSearchParams(window.location.search);
        return {
            name: params.get('name'),
            lastName: params.get('lastName'),
            email: params.get('email')
        };
    }
async function getTodayRota() {
    const today = getTodayDate();
    const response = await fetch(`/api/rota?day=${encodeURIComponent(today)}`);
    if (!response.ok) {
        throw new Error(`HTTP error! Status: ${response.status}`);
    }
    return await response.json();
}
function getTodayDate() {
    const today = new Date();
    const day = String(today.getDate()).padStart(2, '0');
    const month = String(today.getMonth() + 1).padStart(2, '0');
    const year = today.getFullYear();
    const daysOfWeek = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
    const dayOfWeek = daysOfWeek[today.getDay()];
    return `${day}/${month}/${year} (${dayOfWeek})`;
}
async function populateTable() {
    try {
        const rotaData = await getTodayRota();
        const tableBody = document.querySelector('#rotaTable tbody');
        tableBody.innerHTML = ''; // Clear existing rows

        if (rotaData.length === 0) {
            const row = document.createElement('tr');
            const cell = document.createElement('td');
            cell.colSpan = 3;
            cell.textContent = "No data for today.";
            row.appendChild(cell);
            tableBody.appendChild(row);
        } else {
            // Group rotaData by designation (FOH first, then BOH)
            const groupedByDesignation = rotaData.reduce((acc, entry) => {
                acc[entry.designation] = acc[entry.designation] || [];
                acc[entry.designation].push(entry);
                return acc;
            }, {});

            // Loop through each designation group
            const designations = ['FOH', 'BOH'];
            designations.forEach(designation => {
                if (groupedByDesignation[designation]) {
                    // Group entries within each designation by name
                    const groupedByName = groupedByDesignation[designation].reduce((acc, entry) => {
                        const key = `${entry.name} ${entry.lastName}`;
                        acc[key] = acc[key] || [];
                        acc[key].push({ startTime: entry.startTime, endTime: entry.endTime });
                        return acc;
                    }, {});

                    // Loop through each name group within the designation
                    Object.keys(groupedByName).forEach(name => {
                        const row = document.createElement('tr');

                        const nameCell = document.createElement('td');
                        nameCell.textContent = name;
                        row.appendChild(nameCell);

                        const designationCell = document.createElement('td');
                        designationCell.textContent = designation;
                        row.appendChild(designationCell);

                        const timeCell = document.createElement('td');
                        const times = groupedByName[name]; // Get array of start time and end time objects
                        const formattedTimes = times.map(time => `${time.startTime} - ${time.endTime}`); // Format start time and end time
                        timeCell.innerHTML = formattedTimes.join('<br>'); // Join formatted times with comma and space
                        row.appendChild(timeCell);

                        tableBody.appendChild(row);
                    });
                }
            });
        }
    } catch (error) {
        console.error('Error fetching rota data:', error);
    }
}
document.addEventListener('DOMContentLoaded', populateTable);
    const menuBtn = document.getElementById('menuBtn');
    const sidebar = document.getElementById('sidebar');
    const main = document.getElementById('main');
    const body = document.body;
    menuBtn.addEventListener('click', () => {
        sidebar.classList.toggle('open-sidebar');
        main.classList.toggle('open-menu');
        body.classList.toggle('sidebar-open');
    });
  // Function to handle logout button click
  document.getElementById('logoutBtn').addEventListener('click', async () => {
    try {
      const response = await fetch('/logout', {
        method: 'GET',
        credentials: 'same-origin' // Ensures cookies are sent with the request
      });

      if (response.ok) {
        window.location.href = '/'; // Redirect to login page
      } else {
        console.error('Failed to logout:', response.statusText);
        alert('Failed to logout. Please try again.');
      }
    } catch (error) {
      console.error('Failed to logout:', error.message);
      alert('Failed to logout. Please try again.');
    }
  });
</script>
</body>
</html>
